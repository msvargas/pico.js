!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.picojs=e():t.picojs=e()}(this,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},r=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function s(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),s=n(2);e.lploc=s.lploc;var c=n(3);e.Camvas=c.default,e.rgba_to_grayscale=function(t,e,n){for(var i=new Uint8Array(e*n),r=0;r<e;++r)for(var o=0;o<n;++o)i[r*n+o]=(2*t[4*r*n+4*o+0]+7*t[4*r*n+4*o+1]+1*t[4*r*n+4*o+2])/10;return i},e.update_memory=a.pico.instantiate_detection_memory(5),e.facefinder_classify_region=function(t,e,n,i,r){return-1},e.do_puploc=function(t,e,n,i,r){return[-1,-1,NaN,NaN]},e.defaultSizeImage={nrows:480,ncols:640,ldim:640},e.defaultParams={shiftfactor:.1,minsize:100,maxsize:1e3,scalefactor:1.1};var u=i(i({},a.pico),{initialized:!1,loaded:{faceFinder:!1,pupilFinder:!1},baseUri:"https://raw.githubusercontent.com/punisher97/pico.js/master/bin/",fetchBinary:function(t){return fetch(t).then((function(t){return t.arrayBuffer()})).then((function(t){return new Int8Array(t)}))},load:function(t){return r(this,void 0,void 0,(function(){var e=this;return o(this,(function(n){return t&&(this.baseUri=t),[2,Promise.all([this.loadFaceFinder(),this.loadPupilFinder()]).then((function(){e.initialized=!0}))]}))}))},loadFaceFinder:function(t){return void 0===t&&(t="facefinder.bin"),r(this,void 0,void 0,(function(){var n=this;return o(this,(function(i){return[2,this.fetchBinary(this.baseUri+t).then((function(t){e.facefinder_classify_region=n.unpack_cascade(t),u.loaded.faceFinder=!0}))]}))}))},loadPupilFinder:function(t){return void 0===t&&(t="puploc.bin"),r(this,void 0,void 0,(function(){var n=this;return o(this,(function(i){return[2,this.fetchBinary(this.baseUri+t).then((function(t){e.do_puploc=s.lploc.unpack_localizer(t),n.loaded.pupilFinder=!0}))]}))}))}});e.default=u},function(t,e){var n={unpack_cascade:function(t){const e=new DataView(new ArrayBuffer(4));let n=8;e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]);const i=e.getInt32(0,!0);n+=4,e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]);const r=e.getInt32(0,!0);n+=4;const o=[],a=[],s=[];for(let c=0;c<r;++c){Array.prototype.push.apply(o,[0,0,0,0]),Array.prototype.push.apply(o,t.slice(n,n+4*Math.pow(2,i)-4)),n=n+4*Math.pow(2,i)-4;for(let r=0;r<Math.pow(2,i);++r)e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]),a.push(e.getFloat32(0,!0)),n+=4;e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]),s.push(e.getFloat32(0,!0)),n+=4}const c=new Int8Array(o),u=new Float32Array(a),l=new Float32Array(s);return function(t,e,n,o,a){t*=256,e*=256;let s=0,f=0;const d=Math.pow(2,i)>>0;for(let p=0;p<r;++p){idx=1;for(let r=0;r<i;++r)idx=2*idx+(o[(t+c[s+4*idx+0]*n>>8)*a+(e+c[s+4*idx+1]*n>>8)]<=o[(t+c[s+4*idx+2]*n>>8)*a+(e+c[s+4*idx+3]*n>>8)]);if((f+=u[d*p+idx-d])<=l[p])return-1;s+=4*d}return f-l[r-1]}},run_cascade:function(t,e,n){const i=t.pixels,r=t.nrows,o=t.ncols,a=t.ldim,s=n.shiftfactor,c=n.minsize,u=n.maxsize,l=n.scalefactor;let f=c;const d=[];for(;f<=u;){const t=Math.max(s*f,1)>>0,n=f/2+1>>0;for(let s=n;s<=r-n;s+=t)for(let r=n;r<=o-n;r+=t){const t=e(s,r,f,i,a);t>0&&d.push([s,r,f,t])}f*=l}return d},cluster_detections:function(t,e){function n(t,e){const n=t[0],i=t[1],r=t[2],o=e[0],a=e[1],s=e[2],c=Math.max(0,Math.min(n+r/2,o+s/2)-Math.max(n-r/2,o-s/2)),u=Math.max(0,Math.min(i+r/2,a+s/2)-Math.max(i-r/2,a-s/2));return c*u/(r*r+s*s-c*u)}t=t.sort((function(t,e){return e[3]-t[3]}));const i=new Array(t.length).fill(0),r=[];for(let o=0;o<t.length;++o)if(0==i[o]){let a=0,s=0,c=0,u=0,l=0;for(let r=o;r<t.length;++r)n(t[o],t[r])>e&&(i[r]=1,a+=t[r][0],s+=t[r][1],c+=t[r][2],u+=t[r][3],l+=1);r.push([a/l,s/l,c/l,u])}return r},instantiate_detection_memory:function(t){let e=0;const n=[];for(let e=0;e<t;++e)n.push([]);return function(t){for(n[e]=t,e=(e+1)%n.length,t=[],i=0;i<n.length;++i)t=t.concat(n[i]);return t}}};e.pico=n},function(t,e){const n={unpack_localizer:function(t){const e=new DataView(new ArrayBuffer(4));let n=0;e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]);const i=e.getInt32(0,!0);n+=4,e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]);const r=e.getFloat32(0,!0);n+=4,e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]);const o=e.getInt32(0,!0);n+=4,e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]);const a=e.getInt32(0,!0);n+=4;const s=[],c=[];for(let r=0;r<i;++r)for(let i=0;i<o;++i){Array.prototype.push.apply(s,t.slice(n,n+4*Math.pow(2,a)-4)),n=n+4*Math.pow(2,a)-4;for(let i=0;i<Math.pow(2,a);++i)for(let i=0;i<2;++i)e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]),c.push(e.getFloat32(0,!0)),n+=4}const u=new Int8Array(s),l=new Float32Array(c);function f(t,e,n,s,c,f,d){let p=0;const h=Math.pow(2,a)>>0;for(let v=0;v<i;++v){let i=0,m=0;for(let r=0;r<o;++r){let b=0;for(var y=0;y<a;++y){const i=Math.min(c-1,Math.max(0,256*t+u[p+4*b+0]*n>>8)),r=Math.min(f-1,Math.max(0,256*e+u[p+4*b+1]*n>>8)),o=Math.min(c-1,Math.max(0,256*t+u[p+4*b+2]*n>>8)),a=Math.min(f-1,Math.max(0,256*e+u[p+4*b+3]*n>>8));b=2*b+1+(s[i*d+r]>s[o*d+a])}const g=2*(o*h*v+h*r+b-(h-1));i+=l[g+0],m+=l[g+1],p+=4*h-4}t+=i*n,e+=m*n,n*=r}return[t,e]}return function(t,e,n,i,r){const o=[],a=[];for(let s=0;s<i;++s){const i=n*(.925+.15*Math.random());let s=t+.15*n*(.5-Math.random()),c=e+.15*n*(.5-Math.random());[s,c]=f(s,c,i,r.pixels,r.nrows,r.ncols,r.ldim),o.push(s),a.push(c)}return o.sort(),a.sort(),[o[Math.round(i/2)],a[Math.round(i/2)]]}}};e.lploc=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){void 0===e&&(e={video:!0,audio:!1}),this.callback=t,this.constraints=e,this.callback=t;var n=document.createElement("div");this.videoEl=document.createElement("video"),this.videoEl.setAttribute("autoplay","1"),this.videoEl.setAttribute("playsinline","1"),this.videoEl.setAttribute("width","1"),this.videoEl.setAttribute("height","1"),n.appendChild(this.videoEl),document.body.appendChild(n)}return Object.defineProperty(t.prototype,"started",{get:function(){return!this.videoEl.paused},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"video",{get:function(){return this.videoEl},enumerable:!0,configurable:!0}),t.prototype.play=function(){var t=this;return new Promise((function(e,n){return t.videoEl.srcObject?t.videoEl.paused?t.videoEl.play().then((function(){return t.update()})).then(e):void(t.videoEl.ended||t._raId?n(new Error("Fail to play video, it played or ended")):(t.update(),e())):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.mediaDevices.getUserMedia(t.constraints).then((function(e){t.videoEl.srcObject=e,t.update()}),(function(t){t&&n(t)})))}))},t.prototype.stop=function(){this.videoEl.srcObject&&(this._cancelAnimation(),this.videoEl.srcObject.getTracks().forEach((function(t){return t.stop()})),this.videoEl.srcObject=null)},t.prototype.pause=function(){this.videoEl.pause(),this._cancelAnimation()},t.prototype._cancelAnimation=function(){this._raId&&cancelAnimationFrame(this._raId),this._raId=0},t.prototype.update=function(){var t=this;if(this.callback){var e=Date.now(),n=function(){if(!t.videoEl.ended){var i=Date.now()-e;t.callback&&t.callback(t.videoEl,i),e=Date.now(),t._raId=requestAnimationFrame(n)}};this._raId=requestAnimationFrame(n)}},t}();e.default=i}])}));
//# sourceMappingURL=picojs.min.js.map